models:
  - name: stg_candidate
    description: "Staging table for candidates"
    columns:
      - name: _offset
        data_tests:
          - unique
          - not_null
      - name: candidate_id
        data_tests:
          - not_null
          - unique:
              config:
                where: "row_is_active = TRUE"
      - name: primary_skill_id
        data_tests:
          - relationships:
              to: ref('stg_skills')
              field: skill_id
      - name: job_function_id
        data_tests:
          - relationships:
              to: ref('stg_job_functions')
              field: job_function_id
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns:
              - candidate_id
              - row_valid_from
  - name: stg_employee
    description: "Staging table for employees"
    columns:
      - name: _offset
        data_tests:
          - unique
          - not_null
      - name: employee_id
        data_tests:
          - not_null
          - unique:
              config:
                where: "row_is_active = TRUE"
      - name: primary_skill_id
        data_tests:
          - relationships:
              to: ref('stg_skills')
              field: skill_id
      - name: job_function_id
        data_tests:
          - relationships:
              to: ref('stg_job_functions')
              field: job_function_id
  - name: stg_interview
    description: "Staging table for interviews"
    columns:
      - name: _offset
        data_tests:
          - unique
          - not_null
      - name: interview_id
        data_tests:
          - not_null
          - unique:
              config:
                where: "row_is_active = TRUE"
      - name: candidate_id
        data_tests:
          - relationships:
              to: ref('stg_candidate')
              field: candidate_id
      - name: interviewer_id
        data_tests:
          - relationships:
              to: ref('stg_employee')
              field: employee_id
  - name: stg_job_function
    description: "Staging table for job functions"
    columns:
      - name: _offset
        data_tests:
          - unique
          - not_null
      - name: job_function_id
        data_tests:
          - not_null
          - unique:
              config:
                where: "row_is_active = TRUE"
  - name: stg_skills
    description: "Staging table for skills"
    columns:
      - name: _offset
        data_tests:
          - unique
          - not_null
      - name: skill_id
        data_tests:
          - not_null
          - unique:
              config:
                where: "row_is_active = TRUE"