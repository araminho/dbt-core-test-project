sources:
  - name: job
    schema: dbt_source
    description: Job related raw data
    tables:
      - name: candidates
        description: Raw candidates data
        data_tests:
          - unique:
              column_name: _offset
              severity: warn
          - not_null:
              column_name: candidate_id
              severity: warn
        columns:
          - name: primary_skill_id
            data_tests:
              - relationships:
                  to: source('job', 'skills')
                  field: id
                  severity: warn
          - name: job_function_id
            data_tests:
              - relationships:
                  to: source('job', 'job_functions')
                  field: job_function_id
                  severity: warn
        config:
          freshness:
            warn_after:
              count: 30
              period: day
            error_after:
              count: 365
              period: day
          loaded_at_query: "SELECT MAX(TIMESTAMP_MICROS(SAFE_CAST(_created_micros AS INT64))) FROM {{ this }}"
      - name: employees
        description: Raw employees data
        data_tests:
          - unique:
              column_name: _offset
          - not_null:
              column_name: employee_id
        columns:
          - name: primary_skill_id
            data_tests:
              - relationships:
                  to: source('job', 'skills')
                  field: id
                  severity: warn
          - name: job_function_id
            data_tests:
              - relationships:
                  to: source('job', 'job_functions')
                  field: job_function_id
                  severity: warn
        config:
          freshness:
            warn_after:
              count: 10
              period: day
            error_after:
              count: 30
              period: day
          loaded_at_query: "SELECT MAX(TIMESTAMP_MICROS(SAFE_CAST(_created_micros AS INT64))) FROM {{ this }}"
      - name: interviews
        description: Raw interviews data
        data_tests:
          - unique:
              column_name: _offset
          - not_null:
              column_name: id
        columns:
          - name: candidate_id
            data_tests:
              - relationships:
                  to: source('job', 'candidates')
                  field: candidate_id
                  severity: warn
          - name: interviewer_id
            data_tests:
              - relationships:
                  to: source('job', 'employees')
                  field: employee_id
                  severity: warn
        config:
          freshness:
            warn_after:
              count: 365
              period: day
            error_after:
              count: 730
              period: day
          loaded_at_query: "SELECT MAX(TIMESTAMP_MICROS(SAFE_CAST(_created_micros AS INT64))) FROM {{ this }}"
      - name: job_functions
        description: Raw job functions data
        data_tests:
          - unique:
              column_name: _offset
          - not_null:
              column_name: job_function_id
        config:
          freshness:
            warn_after:
              count: 365
              period: day
            error_after:
              count: 730
              period: day
          loaded_at_query: "SELECT MAX(TIMESTAMP_MICROS(SAFE_CAST(_created_micros AS INT64))) FROM {{ this }}"
      - name: skills
        description: Raw skills data
        data_tests:
          - unique:
              column_name: _offset
          - not_null:
              column_name: id
        config:
          freshness:
            warn_after:
              count: 365
              period: day
            error_after:
              count: 730
              period: day
          loaded_at_query: "SELECT MAX(TIMESTAMP_MICROS(SAFE_CAST(_created_micros AS INT64))) FROM {{ this }}"